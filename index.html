<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Citizen Developer Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .score-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 10px;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .game-screen {
            padding: 20px;
            min-height: 500px;
            padding-bottom: 20px;
            display: none;
        }

        .game-screen.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .innovation-card {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.1);
            transition: transform 0.3s;
        }

        .innovation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(100, 116, 139, 0.15);
        }

        .innovation-avatar {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .category-button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 3px solid transparent;
            border-radius: 10px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .category-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .category-button.selected {
            border-color: #fbbf24;
            background: linear-gradient(145deg, #10b981, #059669);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            transform: translateY(-2px);
        }

        .category-button.completed {
            background: linear-gradient(145deg, #6b7280, #4b5563);
            border-color: #10b981;
            opacity: 0.8;
            position: relative;
        }

        .category-button.completed::after {
            content: '✅';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 16px;
        }

        .team-card {
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(100, 116, 139, 0.1);
        }

        .team-card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.15);
        }

        .team-card.selected {
            border-color: #667eea;
            background: linear-gradient(145deg, #f0f4ff, #ffffff);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .process-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .process-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6b7280;
            transition: all 0.3s;
        }

        .process-step.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            animation: pulse 0.5s;
        }

        .process-step.current {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .dialog-box {
            background: #f9fafb;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-style: italic;
        }

        .continue-button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .continue-button:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .feedback {
            padding: 20px;
            background: linear-gradient(145deg, #f3f4f6, #ffffff);
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .feedback.success {
            border: 2px solid #10b981;
        }

        .feedback.error {
            border: 2px solid #ef4444;
        }

        .hint-box {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }

        .story-text {
            line-height: 1.6;
            color: #374151;
            margin: 15px 0;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .achievement-popup.show {
            display: block;
            animation: zoomIn 0.5s;
        }

        @keyframes zoomIn {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .achievement-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .solution-exists {
            background: #dcfce7;
            border: 2px solid #10b981;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .no-solution {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .requirement-item {
            padding: 10px;
            margin: 10px 0;
            background: #f3f4f6;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .cit-dev-image-container {
            margin: 20px auto;
            max-width: 350px;
            text-align: center;
            padding: 15px;
            background: linear-gradient(145deg, #f8fafc, #ffffff);
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
            border: 1px solid #e2e8f0;
        }

        .cit-dev-image {
            width: 100%;
            max-width: 280px;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .cit-dev-image:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(100, 116, 139, 0.2);
        }

        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            z-index: 10000;
            pointer-events: none;
            border-radius: 2px;
        }

        .confetti-1 { background: #ff6b6b; }
        .confetti-2 { background: #4ecdc4; }
        .confetti-3 { background: #45b7d1; }
        .confetti-4 { background: #96ceb4; }
        .confetti-5 { background: #feca57; }
        .confetti-6 { background: #ff9ff3; }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 100px)) rotateZ(360deg);
                opacity: 0;
            }
        }

        .confetti-animate {
            animation: confetti-fall linear forwards;
        }

        @keyframes slideInFade {
            0% { opacity: 0; transform: translateX(100px); }
            20% { opacity: 1; transform: translateX(0); }
            80% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        .score-popup {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 1001;
            animation: slideInFade 2s ease-out forwards;
            pointer-events: none;
        }

        @media (max-width: 380px) {
            .game-container {
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }

            .cit-dev-image-container {
                margin: 15px auto;
                max-width: 320px;
                padding: 10px;
            }

            .cit-dev-image {
                max-width: 250px;
                border-radius: 10px;
            }

            #frontDoorScreen h2 {
                font-size: 16px;
                line-height: 1.1;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        @media (max-width: 320px) {
            #frontDoorScreen h2 {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🚀 Visualize your Citizen Development journey!</h1>
            <div class="score-bar">
                <div class="score-item">
                    <span>⭐</span>
                    <span id="score">0</span>
                </div>
                <div class="score-item">
                    <span>💡</span>
                    <span id="ideas">0</span>
                </div>
                <div class="score-item">
                    <span>🏆</span>
                    <span id="level">1</span>
                </div>
            </div>
        </div>

        <!-- ICP Front Door Screen -->
        <div id="frontDoorScreen" class="game-screen active">
            <h2 style="font-size: 1.2em; text-align: center;">See the path your journey can take</h2>
            
            <!-- Citizen Development Image -->
            <div class="cit-dev-image-container">
                <img src="https://github.com/mky250/citizen-dev-app/blob/main/cit%20dev.png?raw=true" 
                     alt="Citizen Development Framework" 
                     class="cit-dev-image"
                     loading="eager"
                     onerror="this.style.display='none'; console.error('Image failed to load:', this.src);"
                     onload="console.log('Image loaded successfully')"/>
            </div>
            
            <div class="story-text">
                <p><strong>Citizen Development</strong> empowers all CSS team members regardless of role or technical background to contribute ideas, experiment with new technologies, and rapidly build the <strong>next generation</strong> of AI-driven capabilities.</p>
                <p style="margin-top: 15px;">We streamline innovation from idea to production, connecting you with the right teams and resources.</p>
            </div>
            <div class="hint-box">
                💡 <strong>ICP Value:</strong> We prevent duplicate efforts, accelerate development, and scale solutions across the organization!
            </div>
            <button class="continue-button" onclick="game.startJourney()">Start Your Guided Journey</button>
        </div>

        <!-- Self Discovery Screen -->
        <div id="selfDiscoveryScreen" class="game-screen">
            <h2>🔍 Step 1: Self-Discovery</h2>
            
            <div class="process-flow" id="selfDiscoveryFlow"></div>
            
            <div class="story-text">
                <p>First, let's check if your innovation idea already exists.</p>
            </div>
            
            <div class="innovation-card">
                <h3 style="font-size: 0.9em; color: red;">Select an Innovation Journey Example to Explore:</h3>
                <button class="category-button" id="chatbot-btn" onclick="game.checkIdea('chatbot')">
                    🤖 AI Customer Service Chatbot
                </button>
                <button class="category-button" id="analytics-btn" onclick="game.checkIdea('analytics')">
                    🚨 Incident Management Automation
                </button>
                <button class="category-button" id="mobile-btn" onclick="game.checkIdea('mobile')">
                    📄 Case Summarization Analysis
                </button>
                <button class="category-button" id="assistant-btn" onclick="game.checkIdea('assistant')">
                    🧠 AI Meeting Intelligence Assistant
                </button>
            </div>

            <div id="discoveryResult" style="display: none;"></div>
            
            <div id="allCompletedMessage" style="display: none;" class="feedback success">
                <h3>🎉 Journey Master!</h3>
                <p>Congratulations! You've successfully completed all available innovation journeys. You've experienced the full citizen development process from idea validation through enterprise scaling.</p>
                <p style="margin-top: 15px;"><strong>Go here to get started:</strong> <a href="https://aka.ms/AIInnovationFrontDoor" target="_blank" style="color: #667eea; text-decoration: underline;">https://aka.ms/AIInnovationFrontDoor</a></p>
            </div>
        </div>

        <!-- LOB Contact Screen -->
        <div id="lobContactScreen" class="game-screen">
            <h2>📞 Step 2: Contact Your LOB</h2>
            
            <div class="process-flow" id="lobContactFlow"></div>
            
            <div class="story-text">
                <p>Great! Your idea is new. Now connect with your Line of Business (LOB) to submit it to ICP.</p>
            </div>
            
            <div class="innovation-card">
                <h3>Your Innovation:</h3>
                <p id="selectedIdea" class="story-text"></p>
            </div>

            <div class="dialog-box">
                <strong>LOB Innovation Champion:</strong><br>
                "This looks promising! Let me help you submit this to ICP for triage."
            </div>

            <button class="continue-button" onclick="game.submitToICP()">Submit to ICP Pipeline</button>
        </div>

        <!-- Cit Dev Consult Screen -->
        <div id="triageScreen" class="game-screen">
            <h2>⚡ Step 3: Cit Dev Consult</h2>
            
            <div class="process-flow" id="triageFlow"></div>
            
            <div class="story-text">
                <p>Citizen Developer consultants review your innovation and assign it to the best team!</p>
            </div>

            <h3>Available Teams:</h3>
            <div class="team-card" id="team1">
                <strong>🦓 ZebraAI</strong><br>
                <small>Prompt Engineering - Optimizing AI interactions and responses</small>
            </div>
            <div class="team-card" id="team2">
                <strong>🔗 Nexus</strong><br>
                <small>Workflow Automation - Streamlining processes and integrations</small>
            </div>
            <div class="team-card" id="team3">
                <strong>🤖 Agentic Practice</strong><br>
                <small>Agent Building - Creating intelligent autonomous systems</small>
            </div>
            <div class="team-card" id="team4">
                <strong>🚀 AI Innovator Community</strong><br>
                <small>Collaborative AI solutions and experiments</small>
            </div>

            <button class="continue-button" onclick="game.assignTeam()">See Team Assignment</button>
        </div>

        <!-- Incubation Marketplace Screen -->
        <div id="incubationScreen" class="game-screen">
            <h2>🌱 Step 4: Incubation Marketplace</h2>
            <div class="story-text">
                <p><strong>Calling All Citizen Developers!</strong></p>
                <p>Turn innovative idea into a real application. Our Incubation Marketplace is your launchpad. Get matched with a dedicated expert mentor, and gain instant access to powerful starter kits, pre-built templates, and essential SDKs. Follow the simple steps below to onboard and start building your solution today.</p>
            </div>
            
            <div class="process-flow" id="incubationFlow"></div>

            <div class="innovation-card">
                <h3>Citizen Developer Tasks:</h3>
                <div id="incubationTasks">
                    <div class="requirement-item">
                        <p id="req1" style="color: #6b7280;">⏳ Adopt an idea</p>
                    </div>
                    <div class="requirement-item">
                        <p id="req2" style="color: #6b7280;">⏳ Project Accountability</p>
                    </div>
                    <div class="requirement-item">
                        <p id="req3" style="color: #6b7280;">⏳ Onboarding</p>
                    </div>
                </div>
            </div>

            <div id="onboardingAssignment" style="display: none;" class="feedback success">
                <h3>🎯 Ready for Development!</h3>
                <p>You've completed all citizen developer onboarding requirements and are ready to start building!</p>
            </div>

            <div class="hint-box">
                💡 <strong>Why Incubation?</strong> The AI Community ensures every citizen developer is properly trained and matched with the right project!
            </div>

            <button class="continue-button" id="incubationBtn" onclick="game.progressIncubation()">Complete Next Task</button>
        </div>

        <!-- Development Screen -->
        <div id="developmentScreen" class="game-screen">
            <h2>💻 <span id="devStepNumber">Step 5</span>: Development</h2>
            <div class="story-text">
                <p id="teamAssignment"></p>
            </div>
            
            <div class="process-flow" id="devProcessFlow"></div>

            <div class="innovation-card">
                <h3>Development Progress:</h3>
                <div id="devProgress">
                    <p>⏳ Sprint 1: Requirements gathering...</p>
                </div>
            </div>

            <button class="continue-button" onclick="game.progressDevelopment()">Continue Development</button>
        </div>

        <!-- LT Approval Screen -->
        <div id="ltApprovalScreen" class="game-screen">
            <h2>🎯 <span id="ltStepNumber">Step 6</span>: LT Approval</h2>
            <div class="story-text">
                <p>Development complete! The Leadership Team reviews your innovation for scaling.</p>
            </div>
            
            <div class="process-flow" id="ltProcessFlow"></div>

            <div class="feedback success" style="margin-top: 30px;">
                <h3>✅ Leadership Approved!</h3>
                <p class="story-text">
                    Your innovation has been approved for enterprise-wide scaling. 
                    The engineering team will now productize your solution for deployment across the organization.
                </p>
                <p style="font-size: 12px; color: #6b7280; margin-top: 15px; font-style: italic;">
                    Note: If an innovation is not approved for immediate scaling, it gets added to the Solution Catalog 
                    for future reference and potential reactivation.
                </p>
            </div>

            <button class="continue-button" onclick="game.proceedToEngineering()" style="margin-top: 20px;">Scale Out!</button>
        </div>

        <!-- Engineering Screen -->
        <div id="engineeringScreen" class="game-screen">
            <h2>🔧 <span id="engStepNumber">Step 7</span>: Engineering & Productization</h2>
            <div class="story-text">
                <p>LT Approved! Engineering team now productizes your solution for enterprise scale.</p>
            </div>
            
            <div class="process-flow" id="engProcessFlow"></div>

            <div class="innovation-card">
                <h3>Engineering Tasks:</h3>
                <div id="engTasks">
                    <p>✅ Security review completed</p>
                    <p>✅ Performance optimization done</p>
                    <p>⏳ Scalability testing in progress...</p>
                </div>
            </div>

            <button class="continue-button" onclick="game.completeEngineering()">Complete Productization</button>
        </div>

        <!-- Success Screen -->
        <div id="successScreen" class="game-screen">
            <h2>🎉 <span id="successStepNumber">Step 8</span>: Innovation Launched!</h2>
            
            <div class="process-flow" id="successProcessFlow"></div>
            
            <div class="innovation-avatar">🏆</div>
            
            <div class="feedback success">
                <h3>Congratulations!</h3>
                <p class="story-text">Your innovation has been successfully scaled across the organization.</p>
            </div>

            <div class="innovation-card">
                <h3>Journey Summary:</h3>
                <p>✅ Self-discovery completed</p>
                <p>✅ LOB submission successful</p>
                <p>✅ Cit Dev Consult completed</p>
                <p>✅ Incubation marketplace passed</p>
                <p>✅ Development finished</p>
                <p>✅ Leadership approved</p>
                <p>✅ Engineering productized</p>
                <p>✅ Solution scaled out!</p>
            </div>

            <div class="hint-box">
                🌟 <strong>ICP Impact:</strong> Your innovation is now helping thousands of employees and customers!
            </div>

            <div style="margin-top: 20px;">
                <p><strong>Total Points:</strong> <span id="totalScore">0</span></p>
                <p><strong>Ideas Processed:</strong> <span id="totalIdeas">0</span></p>
            </div>

            <button class="continue-button" onclick="game.playAgain()">Start New Innovation</button>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div id="achievementPopup" class="achievement-popup">
        <div class="achievement-icon">🏆</div>
        <h2>Achievement Unlocked!</h2>
        <p id="achievementName">Innovation Champion</p>
        <button class="continue-button" onclick="game.closeAchievement()" style="margin-top: 15px;">Awesome!</button>
    </div>

    <script>
        // Optimized Game Controller
        class CitizenDevelopmentGame {
            constructor() {
                this.state = {
                    score: 0,
                    ideas: 0,
                    level: 1,
                    currentIdea: null,
                    currentTeam: null,
                    devStage: 0,
                    incubationStage: 0,
                    currentScreen: 'frontDoorScreen',
                    completedInnovations: []
                };

                this.innovations = {
                    chatbot: {
                        name: "AI Customer Service Chatbot",
                        exists: true,
                        completed: false,
                        solution: {
                            name: "ServiceBot Pro",
                            team: "AI Innovation Team",
                            contact: "ai.innovations@company.com",
                            status: "Currently in pilot with Customer Service department. 85% query resolution rate."
                        }
                    },
                    analytics: {
                        name: "Incident Management Automation",
                        exists: false,
                        completed: false,
                        bestTeam: "team2"
                    },
                    mobile: {
                        name: "Case Summarization Analysis",
                        exists: false,
                        completed: false,
                        bestTeam: "team1"
                    },
                    assistant: {
                        name: "AI Meeting Intelligence Assistant",
                        exists: false,
                        completed: false,
                        bestTeam: "team4"
                    }
                };

                this.teamNames = {
                    'team1': 'ZebraAI - Prompt Engineering',
                    'team2': 'Nexus - Workflow Automation',
                    'team3': 'Agentic Practice - Agent Building',
                    'team4': 'AI Innovator Community'
                };

                // Cache commonly used DOM elements
                this.elements = {};
                this.cacheElements();
                this.renderProcessFlow('selfDiscoveryFlow', 1, 7);
            }

            cacheElements() {
                this.elements = {
                    score: document.getElementById('score'),
                    ideas: document.getElementById('ideas'),
                    level: document.getElementById('level'),
                    discoveryResult: document.getElementById('discoveryResult'),
                    selectedIdea: document.getElementById('selectedIdea'),
                    teamAssignment: document.getElementById('teamAssignment'),
                    devProgress: document.getElementById('devProgress'),
                    engTasks: document.getElementById('engTasks'),
                    achievementPopup: document.getElementById('achievementPopup'),
                    achievementName: document.getElementById('achievementName')
                };
            }

            // Helper Methods
            isEightStepJourney() {
                return this.state.currentIdea === 'assistant';
            }

            getTotalSteps() {
                return this.isEightStepJourney() ? 8 : 7;
            }

            // Process Flow Rendering
            renderProcessFlow(elementId, currentStep, totalSteps = null) {
                const element = document.getElementById(elementId);
                if (!element) return;

                const steps = totalSteps || this.getTotalSteps();
                let html = '';

                for (let i = 1; i <= steps; i++) {
                    let className = 'process-step';
                    if (i < currentStep) className += ' completed';
                    else if (i === currentStep) className += ' current';
                    
                    html += `<div class="${className}">${i}</div>`;
                }

                element.innerHTML = html;
            }

            // Screen Management
            showScreen(screenId) {
                document.querySelectorAll('.game-screen').forEach(screen => {
                    screen.classList.remove('active');
                });

                const targetScreen = document.getElementById(screenId);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    this.state.currentScreen = screenId;
                }
            }

            // Score Management
            updateScore(points, action) {
                this.state.score += points;
                if (this.elements.score) {
                    this.elements.score.textContent = this.state.score;
                    this.elements.score.style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        this.elements.score.style.animation = '';
                    }, 500);
                }

                if (action) {
                    this.showScorePopup(`+${points} - ${action}`);
                }

                this.checkLevelUp();
            }

            checkLevelUp() {
                const levelThresholds = [0, 100, 250, 450, 700, 1000, 1400, 1900, 2500];
                let newLevel = 1;
                
                for (let i = 0; i < levelThresholds.length; i++) {
                    if (this.state.score >= levelThresholds[i]) {
                        newLevel = i + 1;
                    }
                }

                if (newLevel > this.state.level) {
                    this.state.level = newLevel;
                    if (this.elements.level) {
                        this.elements.level.textContent = this.state.level;
                    }
                    this.showAchievement("Level Up!", `Innovation Champion Level ${this.state.level}`);
                }
            }

            showScorePopup(text) {
                const popup = document.createElement('div');
                popup.className = 'score-popup';
                popup.textContent = text;
                document.body.appendChild(popup);

                setTimeout(() => {
                    if (popup.parentNode) {
                        popup.parentNode.removeChild(popup);
                    }
                }, 2000);
            }

            updateIdeas() {
                this.state.ideas++;
                if (this.elements.ideas) {
                    this.elements.ideas.textContent = this.state.ideas;
                }
            }

            // Achievement System
            showAchievement(title, description) {
                if (this.elements.achievementName) {
                    this.elements.achievementName.textContent = description;
                }
                if (this.elements.achievementPopup) {
                    this.elements.achievementPopup.classList.add('show');
                }
                this.createConfetti();
            }

            closeAchievement() {
                if (this.elements.achievementPopup) {
                    this.elements.achievementPopup.classList.remove('show');
                }
            }

            createConfetti() {
                const confettiCount = 40;
                const colors = ['confetti-1', 'confetti-2', 'confetti-3', 'confetti-4', 'confetti-5', 'confetti-6'];

                for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                        confetti.style.left = Math.random() * 100 + '%';
                        
                        const size = Math.random() * 6 + 4;
                        confetti.style.width = size + 'px';
                        confetti.style.height = size + 'px';
                        
                        const duration = Math.random() * 2 + 2;
                        confetti.style.animationDuration = duration + 's';
                        confetti.classList.add('confetti-animate');
                        
                        if (Math.random() > 0.5) {
                            confetti.style.borderRadius = '50%';
                        }
                        
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            if (confetti && confetti.parentNode) {
                                confetti.parentNode.removeChild(confetti);
                            }
                        }, duration * 1000 + 500);
                    }, i * 50);
                }
            }

            // Game Flow Functions
            startJourney() {
                this.resetGameState();
                this.updateInnovationButtonStates();
                this.showScreen('selfDiscoveryScreen');
                this.updateScore(10, "Journey Started");
                this.renderProcessFlow('selfDiscoveryFlow', 1, 7);
            }

            resetGameState() {
                this.state.currentIdea = null;
                this.state.currentTeam = null;
                this.state.devStage = 0;
                this.state.incubationStage = 0;

                document.querySelectorAll('.team-card').forEach(team => {
                    team.classList.remove('selected');
                });

                document.querySelectorAll('.category-button').forEach(btn => {
                    btn.classList.remove('selected');
                });

                if (this.elements.discoveryResult) {
                    this.elements.discoveryResult.style.display = 'none';
                }

                this.resetIncubationRequirements();
                this.resetDevelopmentProgress();
                this.resetEngineeringTasks();
            }

            resetDevelopmentProgress() {
                if (this.elements.devProgress) {
                    this.elements.devProgress.innerHTML = '<p>⏳ Sprint 1: Requirements gathering...</p>';
                }
            }

            resetEngineeringTasks() {
                if (this.elements.engTasks) {
                    this.elements.engTasks.innerHTML = `
                        <p>✅ Security review completed</p>
                        <p>✅ Performance optimization done</p>
                        <p>⏳ Scalability testing in progress...</p>
                    `;
                }
            }

            updateInnovationButtonStates() {
                let allCompleted = true;

                Object.keys(this.innovations).forEach(type => {
                    const button = document.getElementById(`${type}-btn`);
                    const innovation = this.innovations[type];

                    if (button) {
                        if (innovation.completed) {
                            button.classList.add('completed');
                        } else {
                            button.classList.remove('completed');
                            allCompleted = false;
                        }
                    }
                });

                const completedMessage = document.getElementById('allCompletedMessage');
                if (completedMessage) {
                    completedMessage.style.display = allCompleted ? 'block' : 'none';
                }
            }

            checkIdea(ideaType) {
                const idea = this.innovations[ideaType];
                this.state.currentIdea = ideaType;

                document.querySelectorAll('.category-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                document.getElementById(`${ideaType}-btn`).classList.add('selected');

                // Update progress bar based on innovation
                const totalSteps = ideaType === 'assistant' ? 8 : 7;
                this.renderProcessFlow('selfDiscoveryFlow', 1, totalSteps);

                if (this.elements.discoveryResult) {
                    let resultHTML = '';
                    
                    if (idea.completed) {
                        resultHTML = this.getCompletedInnovationHTML(idea);
                    } else if (idea.exists) {
                        idea.completed = true;
                        this.state.completedInnovations.push(ideaType);
                        this.updateInnovationButtonStates();
                        resultHTML = this.getExistingSolutionHTML(idea);
                        this.updateScore(15, "Found existing solution");
                    } else {
                        resultHTML = this.getNewInnovationHTML();
                        this.updateScore(20, "Discovered new opportunity");
                    }
                    
                    this.elements.discoveryResult.innerHTML = resultHTML;
                    this.elements.discoveryResult.style.display = 'block';
                }
            }

            getCompletedInnovationHTML(idea) {
                return `
                    <div class="feedback success">
                        <h3>🎉 Innovation Already Completed!</h3>
                        <p><strong>${idea.name}</strong> has been successfully launched through the innovation journey!</p>
                        <p style="margin-top: 10px;">🏆 <em>Journey Status: Complete</em></p>
                    </div>
                    <button class="continue-button" onclick="game.tryAnother()">Try Another Innovation</button>
                `;
            }

            getExistingSolutionHTML(idea) {
                return `
                    <div class="solution-exists">
                        <h3>✅ Solution Already Exists!</h3>
                        <p><strong>Name:</strong> ${idea.solution.name}</p>
                        <p><strong>Team:</strong> ${idea.solution.team}</p>
                        <p><strong>Contact:</strong> ${idea.solution.contact}</p>
                        <p><strong>Status:</strong> ${idea.solution.status}</p>
                        <p style="margin-top: 15px; font-weight: bold; color: #10b981;">🏆 Marked as Complete!</p>
                    </div>
                    <button class="continue-button" onclick="game.tryAnother()">Try Another Idea</button>
                `;
            }

            getNewInnovationHTML() {
                return `
                    <div class="no-solution">
                        <h3>💡 New Innovation Opportunity!</h3>
                        <p>No existing solution found. This is a great opportunity to innovate!</p>
                    </div>
                    <button class="continue-button" onclick="game.proceedToLOB()">Proceed to LOB Contact</button>
                `;
            }

            tryAnother() {
                if (this.elements.discoveryResult) {
                    this.elements.discoveryResult.style.display = 'none';
                }
                this.state.currentIdea = null;
                document.querySelectorAll('.category-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
            }

            proceedToLOB() {
                this.showScreen('lobContactScreen');
                this.renderProcessFlow('lobContactFlow', 2);
                
                if (this.elements.selectedIdea && this.state.currentIdea) {
                    this.elements.selectedIdea.textContent = this.innovations[this.state.currentIdea].name;
                }
                
                this.updateScore(10, "LOB contact initiated");
            }

            submitToICP() {
                this.showScreen('triageScreen');
                this.renderProcessFlow('triageFlow', 3);
                this.updateScore(25, "Idea submitted to ICP");
                this.updateIdeas();
            }

            assignTeam() {
                if (this.state.currentIdea) {
                    const bestTeam = this.innovations[this.state.currentIdea].bestTeam || 'team4';
                    this.state.currentTeam = bestTeam;

                    document.querySelectorAll('.team-card').forEach(team => {
                        team.classList.remove('selected');
                    });

                    const selectedTeam = document.getElementById(bestTeam);
                    if (selectedTeam) {
                        selectedTeam.classList.add('selected');
                    }
                }

                this.updateScore(30, "Team assigned");

                setTimeout(() => {
                    if (this.elements.teamAssignment) {
                        this.elements.teamAssignment.textContent = 
                            `Your innovation has been assigned to: ${this.teamNames[this.state.currentTeam] || 'AI Innovator Community'}`;
                    }

                    if (this.state.currentTeam === 'team4') {
                        this.showScreen('incubationScreen');
                        this.renderProcessFlow('incubationFlow', 4);
                    } else {
                        this.showDevelopmentScreen();
                    }
                }, 2000);
            }

            progressIncubation() {
                this.state.incubationStage++;

                const requirements = [
                    { id: 'req1', text: '✅ Adopt an idea', points: 15, action: "Idea adopted" },
                    { id: 'req2', text: '✅ Project Accountability', points: 20, action: "Accountability accepted" },
                    { id: 'req3', text: '✅ Onboarding', points: 25, action: "Onboarding completed" }
                ];

                if (this.state.incubationStage <= requirements.length) {
                    const currentReq = requirements[this.state.incubationStage - 1];
                    const reqElement = document.getElementById(currentReq.id);
                    
                    if (reqElement) {
                        reqElement.innerHTML = currentReq.text;
                        reqElement.style.color = '#ffffff';
                        reqElement.style.fontWeight = 'bold';
                        reqElement.parentElement.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        reqElement.parentElement.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
                    }
                    
                    this.updateScore(currentReq.points, currentReq.action);

                    if (this.state.incubationStage >= requirements.length) {
                        const onboardingDiv = document.getElementById('onboardingAssignment');
                        if (onboardingDiv) {
                            onboardingDiv.style.display = 'block';
                        }

                        const btn = document.getElementById('incubationBtn');
                        if (btn) {
                            btn.textContent = 'Proceed to Development';
                            btn.onclick = () => this.showDevelopmentScreen();
                        }

                        this.showAchievement("Citizen Developer Ready!", "You've completed all onboarding requirements");
                    }
                }
            }

            resetIncubationRequirements() {
                this.state.incubationStage = 0;

                const requirements = ['Adopt an idea', 'Project Accountability', 'Onboarding'];
                requirements.forEach((req, i) => {
                    const reqEl = document.getElementById(`req${i + 1}`);
                    if (reqEl) {
                        reqEl.innerHTML = `⏳ ${req}`;
                        reqEl.style.color = '#6b7280';
                        reqEl.style.fontWeight = 'normal';
                        reqEl.parentElement.style.background = '#f3f4f6';
                        reqEl.parentElement.style.boxShadow = 'none';
                    }
                });

                const onboardingDiv = document.getElementById('onboardingAssignment');
                if (onboardingDiv) {
                    onboardingDiv.style.display = 'none';
                }

                const btn = document.getElementById('incubationBtn');
                if (btn) {
                    btn.textContent = 'Complete Next Task';
                    btn.onclick = () => this.progressIncubation();
                }
            }

            showDevelopmentScreen() {
                this.showScreen('developmentScreen');
                
                if (this.isEightStepJourney()) {
                    document.getElementById('devStepNumber').textContent = 'Step 5';
                    this.renderProcessFlow('devProcessFlow', 5);
                } else {
                    document.getElementById('devStepNumber').textContent = 'Step 4';
                    this.renderProcessFlow('devProcessFlow', 4);
                }
            }

            progressDevelopment() {
                this.state.devStage++;
                
                const stages = [
                    '✅ Sprint 1: Requirements gathering complete',
                    '✅ Sprint 2: Prototype developed',
                    '✅ Sprint 3: Testing completed',
                    '✅ Sprint 4: Ready for productization!'
                ];

                if (this.elements.devProgress) {
                    if (this.state.devStage < stages.length) {
                        this.elements.devProgress.innerHTML = stages.slice(0, this.state.devStage + 1)
                            .map(s => `<p>${s}</p>`).join('');
                        this.updateScore(20, `Sprint ${this.state.devStage + 1} completed`);
                    } else {
                        this.showLTApprovalScreen();
                        this.state.devStage = 0;
                    }
                }
            }

            showLTApprovalScreen() {
                this.showScreen('ltApprovalScreen');
                this.updateScore(40, "Leadership approval");

                if (this.isEightStepJourney()) {
                    document.getElementById('ltStepNumber').textContent = 'Step 6';
                    this.renderProcessFlow('ltProcessFlow', 6);
                } else {
                    document.getElementById('ltStepNumber').textContent = 'Step 5';
                    this.renderProcessFlow('ltProcessFlow', 5);
                }
            }

            proceedToEngineering() {
                this.showEngineeringScreen();
            }

            showEngineeringScreen() {
                this.showScreen('engineeringScreen');

                if (this.isEightStepJourney()) {
                    document.getElementById('engStepNumber').textContent = 'Step 7';
                    this.renderProcessFlow('engProcessFlow', 7);
                } else {
                    document.getElementById('engStepNumber').textContent = 'Step 6';
                    this.renderProcessFlow('engProcessFlow', 6);
                }
            }

            completeEngineering() {
                if (this.elements.engTasks) {
                    this.elements.engTasks.innerHTML = `
                        <p>✅ Security review completed</p>
                        <p>✅ Performance optimization done</p>
                        <p>✅ Scalability testing completed</p>
                        <p>✅ Production deployment ready!</p>
                    `;
                }
                
                this.updateScore(50, "Engineering completed");

                setTimeout(() => {
                    this.showSuccessScreen();
                    
                    if (this.state.ideas === 1) {
                        this.showAchievement("Innovation Pioneer!", "You've completed your first innovation journey");
                    } else if (this.state.ideas === 3) {
                        this.showAchievement("Innovation Expert!", "You've completed 3 innovation journeys");
                    } else if (this.state.ideas === 5) {
                        this.showAchievement("Innovation Master!", "You've completed 5 innovation journeys");
                    }
                }, 1500);
            }

            showSuccessScreen() {
                this.showScreen('successScreen');

                if (this.state.currentIdea) {
                    this.innovations[this.state.currentIdea].completed = true;
                    this.state.completedInnovations.push(this.state.currentIdea);
                }

                if (this.isEightStepJourney()) {
                    document.getElementById('successStepNumber').textContent = 'Step 8';
                    this.renderProcessFlow('successProcessFlow', 8);
                } else {
                    document.getElementById('successStepNumber').textContent = 'Step 7';
                    this.renderProcessFlow('successProcessFlow', 7);
                }

                document.getElementById('totalScore').textContent = this.state.score;
                document.getElementById('totalIdeas').textContent = this.state.ideas;
            }

            playAgain() {
                this.resetGameState();
                this.showScreen('frontDoorScreen');
            }
        }

        // Initialize the game
        const game = new CitizenDevelopmentGame();
    </script>
</body>
</html>
