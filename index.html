<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Citizen Developer Journey</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --success: #10b981;
            --success-dark: #059669;
            --info: #0ea5e9;
            --info-dark: #0284c7;
            --warning: #fbbf24;
            --warning-light: #fef3c7;
            --text: #374151;
            --text-muted: #6b7280;
            --bg: #f9fafb;
            --border: #e5e7eb;
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gradient-success: linear-gradient(135deg, var(--success), var(--success-dark));
            --gradient-info: linear-gradient(145deg, var(--info), var(--info-dark));
            --shadow: 0 4px 12px rgba(100, 116, 139, 0.15);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.2);
            --radius: 10px;
            --radius-lg: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--gradient-primary); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 10px; }
        
        /* Container */
        .container { width: 100%; max-width: 400px; background: white; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); overflow: hidden; position: relative; }
        
        /* Header */
        .header { background: var(--gradient-primary); color: white; padding: 20px; text-align: center; position: relative; }
        .header h1 { font-size: 1.3em; line-height: 1.3; }
        
        /* Buttons */
        .btn { border: none; cursor: pointer; transition: var(--transition); font-weight: bold; border-radius: var(--radius); }
        .btn-help { position: absolute; top: 20px; right: 20px; width: 30px; height: 30px; border-radius: 50%; background: rgba(255,255,255,0.2); border: 2px solid white; color: white; font-size: 18px; display: flex; align-items: center; justify-content: center; }
        .btn-help:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }
        .btn-primary { width: 100%; padding: 15px; margin-top: 20px; background: var(--gradient-success); color: white; font-size: 16px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4); }
        .btn-category { width: 100%; padding: 15px; margin: 10px 0; border: 3px solid transparent; background: var(--gradient-primary); color: white; font-size: 16px; position: relative; }
        .btn-category:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-category.selected { border-color: var(--warning); background: var(--gradient-success); }
        .btn-category.unexplored { animation: pulse-glow 2s infinite; }
        .btn-category.existing-solution { background: var(--gradient-info); }
        .btn-category.completed { background: var(--gradient-success); opacity: 0.9; }
        .btn-category::after { position: absolute; top: 8px; right: 8px; font-size: 16px; }
        .btn-category.existing-solution::after { content: 'ℹ️'; }
        .btn-category.completed::after { content: '✅'; }
        
        /* Journey Tracker */
        .tracker { background: var(--bg); padding: 10px; display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 12px; border-bottom: 1px solid var(--border); }
        .tracker span { color: #9ca3af; transition: var(--transition); }
        .tracker .active { color: var(--primary); font-weight: bold; }
        .tracker .completed { color: var(--success); }
        
        /* Score Bar */
        .score-bar { display: flex; justify-content: center; gap: 30px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: var(--radius); margin-top: 10px; }
        .score-item { display: flex; align-items: center; gap: 5px; position: relative; }
        .tooltip { display: none; position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; font-size: 11px; white-space: nowrap; z-index: 10; }
        .score-item:hover .tooltip { display: block; }
        
        /* Cards */
        .card { background: linear-gradient(145deg, #f8fafc, white); border: 1px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow); transition: var(--transition); }
        .card:hover { transform: translateY(-2px); }
        
        /* Screens */
        .screen { padding: 20px; min-height: 500px; display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s; }
        
        /* Process Flow */
        .process-flow { display: flex; justify-content: space-between; margin: 20px 0; padding: 15px; background: var(--bg); border-radius: var(--radius); }
        .step { width: 40px; height: 40px; border-radius: 50%; background: var(--border); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--text-muted); transition: var(--transition); }
        .step.completed { background: var(--gradient-success); color: white; }
        .step.current { background: var(--gradient-primary); color: white; animation: pulse 1s infinite; }
        
        /* Feedback */
        .feedback { padding: 20px; background: linear-gradient(145deg, #f3f4f6, white); border-radius: 15px; margin: 20px 0; text-align: center; }
        .feedback.success { border: 2px solid var(--success); }
        .solution-exists { background: #dbeafe; border: 2px solid var(--info); padding: 15px; border-radius: var(--radius); margin: 15px 0; }
        .no-solution { background: var(--warning-light); border: 2px solid var(--warning); padding: 15px; border-radius: var(--radius); margin: 15px 0; }
        
        /* Team Cards */
        .team-card { background: linear-gradient(145deg, #f8fafc, white); border: 2px solid var(--border); border-radius: var(--radius); padding: 15px; margin: 10px 0; transition: var(--transition); cursor: pointer; }
        .team-card:hover { border-color: #cbd5e1; box-shadow: var(--shadow); }
        .team-card.selected { border-color: var(--primary); background: linear-gradient(145deg, #f0f4ff, white); }
        
        /* Common */
        .story-text { line-height: 1.6; color: var(--text); margin: 15px 0; }
        .hint-box { background: var(--warning-light); border: 1px solid var(--warning); padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 14px; }
        .hint-banner { background: linear-gradient(135deg, var(--warning-light), #fde68a); border: 2px solid var(--warning); padding: 12px; border-radius: var(--radius); margin: 15px 0; text-align: center; font-size: 14px; color: #78350f; }
        .dialog-box { background: var(--bg); border-left: 4px solid var(--primary); padding: 15px; margin: 20px 0; border-radius: 5px; font-style: italic; }
        .requirement-item { padding: 10px; margin: 10px 0; background: #f3f4f6; border-radius: 8px; transition: var(--transition); }
        .panel-instruction { background: linear-gradient(145deg, #f0f9ff, #dbeafe); border: 2px solid var(--info); padding: 15px; border-radius: var(--radius); margin: 15px 20px; }
        .panel-instruction h3 { color: var(--info-dark); margin-bottom: 10px; font-size: 14px; }
        .panel-instruction ol { text-align: left; color: #475569; line-height: 1.8; padding-left: 20px; font-size: 13px; }
        
        /* Image */
        .cit-dev-image-container { margin: 20px auto; max-width: 350px; text-align: center; padding: 15px; background: linear-gradient(145deg, #f8fafc, white); border-radius: var(--radius-lg); box-shadow: var(--shadow); border: 1px solid var(--border); }
        .cit-dev-image { width: 100%; max-width: 280px; height: auto; border-radius: 15px; box-shadow: var(--shadow); }
        
        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: var(--radius-lg); max-width: 350px; max-height: 80vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: var(--text-muted); }
        
        /* Achievement */
        .achievement { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); text-align: center; z-index: 1000; display: none; }
        .achievement.show { display: block; animation: zoomIn 0.5s; }
        .achievement-icon { font-size: 60px; margin-bottom: 15px; }
        
        /* Scroll Indicators */
        .scroll-progress { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: rgba(102,126,234,0.2); z-index: 2001; transform-origin: left; transform: scaleX(0); transition: transform 0.2s; }
        .scroll-indicator { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 999; cursor: pointer; box-shadow: var(--shadow); animation: bounce 2s infinite; transition: opacity 0.3s; }
        .scroll-indicator::before { content: '↓'; color: white; font-size: 20px; font-weight: bold; }
        .scroll-text { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); color: var(--primary); font-size: 12px; font-weight: bold; z-index: 998; background: rgba(255,255,255,0.9); padding: 5px 15px; border-radius: 20px; box-shadow: 0 2px 8px rgba(102,126,234,0.2); }
        .hidden { opacity: 0; pointer-events: none; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 0 0 rgba(102,126,234,0); } 50% { box-shadow: 0 0 10px 2px rgba(102,126,234,0.4); } }
        @keyframes zoomIn { from { transform: translate(-50%, -50%) scale(0); } to { transform: translate(-50%, -50%) scale(1); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); } 40% { transform: translateX(-50%) translateY(-10px); } 60% { transform: translateX(-50%) translateY(-5px); } }
        
        /* Confetti */
        .confetti { position: fixed; width: 8px; height: 8px; z-index: 10000; pointer-events: none; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(calc(100vh + 100px)) rotateZ(360deg); opacity: 0; } }
        
        /* Score Popup */
        .score-popup { position: fixed; top: 80px; right: 20px; background: var(--success); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; z-index: 1001; animation: slideInFade 2s forwards; pointer-events: none; }
        @keyframes slideInFade { 0% { opacity: 0; transform: translateX(100px); } 20% { opacity: 1; transform: translateX(0); } 80% { opacity: 1; } 100% { opacity: 0; transform: translateY(-20px); } }
        
        /* Mobile */
        @media (max-width: 768px) {
            body { padding: 0; }
            .container { border-radius: 0; max-width: 100%; min-height: 100vh; }
            .header { padding: 15px; }
            .header h1 { font-size: 1.2em; padding: 0 45px 0 0; }
            .btn-help { width: 35px; height: 35px; top: 15px; right: 10px; }
            .tracker { padding: 8px; font-size: 11px; }
            .score-bar { padding: 8px; gap: 15px; }
            .screen { padding: 15px; min-height: calc(100vh - 200px); }
            .card { padding: 15px; }
            .btn-category, .btn-primary { min-height: 56px; touch-action: manipulation; }
            .process-flow { padding: 10px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .step { width: 35px; height: 35px; font-size: 14px; flex-shrink: 0; }
            .scroll-indicator { bottom: 20px; width: 35px; height: 35px; }
            .scroll-text { bottom: 65px; font-size: 11px; }
            .tooltip { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="btn btn-help" onclick="G.showHelp()">?</button>
            <h1>🚀 Visualize your Citizen Development journey!</h1>
            <div class="score-bar">
                <div class="score-item"><span>🎓</span><span id="level">1</span><div class="tooltip">Newcomer</div></div>
                <div class="score-item"><span>⭐</span><span id="score">0</span><div class="tooltip">Points earned</div></div>
                <div class="score-item"><span>💡</span><span id="ideas">0</span><div class="tooltip">Ideas processed</div></div>
                <div class="score-item"><span>🏆</span><span id="achievements">0</span><div class="tooltip">Journeys completed</div></div>
            </div>
        </div>
        
        <div class="tracker">
            <span id="t-home">Home</span><span>→</span>
            <span id="t-discovery">Discovery</span><span>→</span>
            <span id="t-journey">Journey</span>
        </div>
        
        <!-- Front Door Screen -->
        <div id="s-front" class="screen active">
            <h2 style="font-size: 1.2em; text-align: center;">See the path your journey can take</h2>
            <div class="cit-dev-image-container">
                <img src="https://github.com/mky250/citizen-dev-app/blob/main/cit%20dev.png?raw=true" 
                     alt="Citizen Development Framework" class="cit-dev-image" loading="eager" 
                     onerror="this.style.display='none'"/>
            </div>
            <div class="story-text">
                <p><strong>Citizen Development</strong> empowers all CSS team members regardless of role or technical background to contribute ideas, experiment with new technologies, and rapidly build the <strong>next generation</strong> of AI-driven capabilities.</p>
                <p style="margin-top: 15px;">We streamline innovation from idea to production, connecting you with the right teams and resources.</p>
            </div>
            <div class="hint-box">💡 <strong>ICP Value:</strong> We prevent duplicate efforts, accelerate development, and scale solutions across the organization!</div>
            <div class="panel-instruction">
                <h3>How This Works:</h3>
                <ol>
                    <li>Explore 4 different innovation journey examples</li>
                    <li>See if solutions already exist or need development</li>
                    <li>Follow the journey from idea to production</li>
                    <li>Learn the actual process along the way</li>
                    <li>Ready with a real idea? Visit <a href="https://aka.ms/AIInnovationFrontDoor" target="_blank" style="color: #0284c7; font-weight: bold;">AI Innovation Front Door</a> or email <a href="mailto:ICP_Inquiries@microsoft.com" style="color: #0284c7; font-weight: bold;">ICP_Inquiries@microsoft.com</a></li>
                </ol>
            </div>
            <button class="btn btn-primary" onclick="G.start()">Start Your Guided Journey</button>
        </div>
        
        <!-- Discovery Screen -->
        <div id="s-discovery" class="screen">
            <h2>🔍 Step 1: Self-Discovery</h2>
            <div style="text-align: center; margin: 20px 0;">
                <p style="color: #6b7280;">Progress: <strong><span id="exp-count">0</span>/4 innovations explored</strong></p>
                <div style="width: 100%; background: #e5e7eb; height: 8px; border-radius: 4px; margin-top: 10px; overflow: hidden;">
                    <div id="progress" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
            </div>
            <div class="process-flow" id="flow-discovery"></div>
            <div class="story-text"><p>First, let's check if your innovation idea already exists.</p></div>
            <div id="hint" class="hint-banner" style="display: none;">👆 Click any innovation below to start exploring! Start with the highlighted one.</div>
            <div class="card">
                <h3 style="font-size: 0.9em; color: #667eea;">Select an Innovation Journey Example to Explore:</h3>
                <div id="innovations"></div>
            </div>
            <div id="result" style="display: none;"></div>
            <div id="completed-msg" style="display: none;" class="feedback success">
                <h3>🎉 Journey Master!</h3>
                <p>Congratulations! You've successfully completed all available innovation journeys.</p>
                <p style="margin-top: 15px;"><strong>Ready to get started?</strong></p>
                <p style="margin-top: 8px;">📌 Visit the <a href="https://aka.ms/AIInnovationFrontDoor" target="_blank" style="color: #667eea;">AI Innovation Front Door</a></p>
                <p style="margin-top: 5px; color: #6b7280; font-style: italic;">or</p>
                <p style="margin-top: 5px;">📧 Contact our team: <a href="mailto:ICP_Inquiries@microsoft.com" style="color: #667eea;">ICP_Inquiries@microsoft.com</a></p>
            </div>
        </div>
        
        <!-- Dynamic Screens Container -->
        <div id="dynamic-screens"></div>
    </div>
    
    <!-- Scroll Indicators -->
    <div class="scroll-progress" id="scroll-bar"></div>
    <div class="scroll-indicator hidden" id="scroll-btn" onclick="G.scrollDown()"></div>
    <div class="scroll-text hidden" id="scroll-txt">Scroll for more</div>
    
    <!-- Achievement Popup -->
    <div class="achievement" id="achievement">
        <div class="achievement-icon">🏆</div>
        <h2>Achievement Unlocked!</h2>
        <p id="achievement-text">Innovation Champion</p>
        <button class="btn btn-primary" onclick="G.closeAchievement()" style="margin-top: 15px;">Awesome!</button>
    </div>
    
    <!-- Help Modal -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="G.closeHelp()">&times;</span>
            <h2>📚 Help & Guide</h2>
            <div style="margin-top: 20px;">
                <h3>What is this tool?</h3>
                <p style="color: #6b7280; margin: 10px 0;">An interactive guide to understand the Citizen Development innovation process at CSS.</p>
                <h3 style="margin-top: 20px;">What is ICP?</h3>
                <p style="color: #6b7280; margin: 10px 0;">Innovation Collaboration Platform - manages innovation ideas from concept to production.</p>
                <h3 style="margin-top: 20px;">How to use:</h3>
                <ol style="color: #6b7280; line-height: 1.8; padding-left: 20px;">
                    <li>Explore 4 innovation examples</li>
                    <li>Some show existing solutions, others need development</li>
                    <li>Follow the complete journey for new innovations</li>
                    <li>Complete all 4 to master the process!</li>
                </ol>
                <h3 style="margin-top: 20px;">Ready to submit a real idea?</h3>
                <p style="color: #6b7280; margin: 10px 0;">Visit the <a href="https://aka.ms/AIInnovationFrontDoor" target="_blank" style="color: #667eea;">AI Innovation Front Door</a></p>
                <p style="color: #6b7280; font-style: italic; margin: 5px 0;">or</p>
                <p style="color: #6b7280; margin: 5px 0;">Email: <a href="mailto:ICP_Inquiries@microsoft.com" style="color: #667eea;">ICP_Inquiries@microsoft.com</a></p>
            </div>
        </div>
    </div>
    
    <script>
    // Enterprise-optimized Game Engine
    const G = (() => {
        'use strict';
        
        // Constants & Configuration
        const CONFIG = {
            levels: ["", "Newcomer", "Explorer", "Practitioner", "Innovator", "Expert", "Master", "Champion", "Visionary", "Legend"],
            thresholds: [0, 100, 250, 450, 700, 1000, 1400, 1900, 2500],
            teams: {
                team1: 'ZebraAI - Prompt Engineering',
                team2: 'Nexus - Workflow Automation',
                team3: 'Agentic Practice - Agent Building',
                team4: 'AI Innovator Community'
            },
            innovations: {
                chatbot: {
                    name: "AI Customer Service Chatbot",
                    desc: "An intelligent virtual assistant that handles customer inquiries 24/7",
                    exists: true,
                    solution: {
                        name: "ServiceBot Pro",
                        team: "AI Innovation Team",
                        contact: "ai.innovations@company.com",
                        status: "Currently in pilot with Customer Service department. 85% query resolution rate."
                    }
                },
                analytics: {
                    name: "Incident Management Automation",
                    desc: "Automated system that detects, categorizes, and routes IT incidents",
                    exists: false,
                    bestTeam: "team2"
                },
                mobile: {
                    name: "Case Summarization Analysis",
                    desc: "AI-powered tool that automatically analyzes support cases",
                    exists: false,
                    bestTeam: "team1"
                },
                assistant: {
                    name: "AI Meeting Intelligence Assistant",
                    desc: "Smart assistant that joins meetings, takes notes, extracts action items",
                    exists: false,
                    bestTeam: "team4"
                }
            },
            screens: [
                { id: 's-lob', title: '📞 Step 2: Contact Your ICP SME', flow: 'lob', step: 2 },
                { id: 's-triage', title: '⚡ Step 3: Cit Dev Consult', flow: 'triage', step: 3 },
                { id: 's-incubation', title: '🌱 Step 4: Incubation Marketplace', flow: 'incubation', step: 4 },
                { id: 's-dev', title: '💻 Development', flow: 'dev', step: 4 },
                { id: 's-lt', title: '🎯 LT Approval', flow: 'lt', step: 5 },
                { id: 's-eng', title: '🔧 Engineering & Productization', flow: 'eng', step: 6 },
                { id: 's-success', title: '🎉 Mission Complete!', flow: null, step: 7 }
            ]
        };
        
        // State Management
        const state = {
            score: 0,
            ideas: 0,
            level: 1,
            currentIdea: null,
            currentTeam: null,
            devStage: 0,
            incubationStage: 0,
            currentScreen: 's-front',
            completedInnovations: new Set(),
            checkedInnovations: new Set(),
            journeyStarted: false,
            achievements: 0,
            earnedAchievements: new Set(),
            firstTimeUser: true,
            scoredActions: {
                lob: new Set(),
                icp: new Set(),
                team: new Set(),
                incubation: new Set(),
                development: new Set(),
                ltApproval: new Set(),
                engineering: new Set()
            }
        };
        
        // DOM Cache
        const dom = {};
        const $ = id => dom[id] || (dom[id] = document.getElementById(id));
        const $$ = (selector, parent = document) => parent.querySelectorAll(selector);
        
        // Utility Functions
        const render = (template) => {
            const div = document.createElement('div');
            div.innerHTML = template;
            return div.firstElementChild || div;
        };
        
        const animate = (element, animation, duration = 500) => {
            element.style.animation = `${animation} ${duration}ms`;
            setTimeout(() => element.style.animation = '', duration);
        };
        
        const showScreen = (screenId) => {
            $$('.screen').forEach(s => s.classList.remove('active'));
            const screen = $(screenId);
            if (screen) {
                screen.classList.add('active');
                state.currentScreen = screenId;
                updateTracker();
                window.scrollTo(0, 0);
            }
        };
        
        // Core Game Logic
        const updateScore = (points, action) => {
            state.score += points;
            $('score').textContent = state.score;
            animate($('score'), 'pulse');
            if (action) showScorePopup(`+${points} - ${action}`);
            checkLevelUp();
        };
        
        const checkLevelUp = () => {
            const newLevel = CONFIG.thresholds.findLastIndex(t => state.score >= t) + 1;
            if (newLevel > state.level) {
                state.level = newLevel;
                $('level').textContent = newLevel;
            }
        };
        
        const showScorePopup = (text) => {
            const popup = render(`<div class="score-popup">${text}</div>`);
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2000);
        };
        
        const updateProgress = () => {
            const explored = [...state.checkedInnovations].filter(k => 
                CONFIG.innovations[k].exists || state.completedInnovations.has(k)
            ).length;
            const pct = (explored / 4) * 100;
            $('exp-count').textContent = explored;
            $('progress').style.width = `${pct}%`;
            $('completed-msg').style.display = explored === 4 ? 'block' : 'none';
        };
        
        const updateTracker = () => {
            const screen = state.currentScreen;
            ['t-home', 't-discovery', 't-journey'].forEach(t => $(t).className = '');
            
            if (screen === 's-front') {
                $('t-home').className = 'active';
            } else if (screen === 's-discovery') {
                $('t-home').className = 'completed';
                $('t-discovery').className = 'active';
            } else {
                $('t-home').className = 'completed';
                $('t-discovery').className = 'completed';
                $('t-journey').className = 'active';
            }
        };
        
        const renderFlow = (containerId, current, total = null) => {
            const steps = total || (state.currentIdea === 'assistant' ? 8 : 7);
            const html = Array.from({length: steps}, (_, i) => {
                const n = i + 1;
                let cls = 'step';
                if (n < current) cls += ' completed';
                else if (n === current) cls += ' current';
                return `<div class="${cls}">${n}</div>`;
            }).join('');
            const container = $(containerId);
            if (container) container.innerHTML = html;
        };
        
        // Achievement System
        const showAchievement = (title, desc) => {
            const key = `${title}_${desc}`;
            if (!state.earnedAchievements.has(key)) {
                state.earnedAchievements.add(key);
                state.achievements++;
                $('achievements').textContent = state.achievements;
                animate($('achievements'), 'pulse');
            }
            
            $('achievement-text').textContent = desc;
            $('achievement').classList.add('show');
            createConfetti();
            setTimeout(() => closeAchievement(), 3000);
        };
        
        const closeAchievement = () => {
            $('achievement').classList.remove('show');
        };
        
        const createConfetti = () => {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    const c = render(`<div class="confetti" style="left: ${Math.random()*100}%; background: ${colors[i%6]}; animation-duration: ${Math.random()*2+2}s"></div>`);
                    document.body.appendChild(c);
                    setTimeout(() => c.remove(), 4000);
                }, i * 50);
            }
        };
        
        // Innovation Management
        const initInnovations = () => {
            const container = $('innovations');
            container.innerHTML = Object.entries(CONFIG.innovations).map(([key, inn]) => `
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-category" id="${key}-btn" onclick="G.checkIdea('${key}')">
                        ${key === 'chatbot' ? '🤖' : key === 'analytics' ? '🚨' : key === 'mobile' ? '📄' : '🧠'} ${inn.name}
                    </button>
                    <p style="font-size: 12px; color: #6b7280; margin: 5px 10px 15px 10px; line-height: 1.4;">${inn.desc}</p>
                </div>
            `).join('');
        };
        
        const checkIdea = (type) => {
            const idea = CONFIG.innovations[type];
            state.currentIdea = type;
            
            const isFirst = !state.checkedInnovations.has(type);
            if (isFirst) state.checkedInnovations.add(type);
            
            if ($('hint')) $('hint').style.display = 'none';
            
            $$('.btn-category').forEach(b => b.classList.remove('selected'));
            $(`${type}-btn`).classList.add('selected');
            
            renderFlow('flow-discovery', 1, type === 'assistant' ? 8 : 7);
            
            let html = '';
            if (idea.exists) {
                if (!state.completedInnovations.has(type)) {
                    state.completedInnovations.add(type);
                    updateButtonStates();
                }
                html = getExistingSolution(idea);
                if (isFirst) updateScore(15, "Found existing solution");
            } else if (state.completedInnovations.has(type)) {
                html = getCompletedInnovation(idea);
            } else {
                html = getNewInnovation();
                if (isFirst) updateScore(20, "Discovered new opportunity");
            }
            
            $('result').innerHTML = html;
            $('result').style.display = 'block';
            
            updateProgress();
            highlightNext();
            updateButtonStates();
        };
        
        const getExistingSolution = (idea) => {
            const hasMore = Object.keys(CONFIG.innovations).some(k => !state.checkedInnovations.has(k));
            return `
                <div class="solution-exists">
                    <h3>✅ Solution Already Exists!</h3>
                    <p><strong>Name:</strong> ${idea.solution.name}</p>
                    <p><strong>Team:</strong> ${idea.solution.team}</p>
                    <p><strong>Contact:</strong> ${idea.solution.contact}</p>
                    <p><strong>Status:</strong> ${idea.solution.status}</p>
                    <p style="margin-top: 10px;"><strong>ADO Link:</strong> <span style="color: #6b7280;">https://dev.azure.com/project/workitem-12345</span></p>
                    <p style="margin-top: 15px; font-weight: bold; color: #0ea5e9;">📧 Contact the team to get plugged in</p>
                </div>
                ${hasMore ? `<button class="btn btn-primary" onclick="G.tryAnother()">Try Another Idea</button>` : ''}
            `;
        };
        
        const getCompletedInnovation = (idea) => {
            const hasMore = Object.keys(CONFIG.innovations).some(k => !state.checkedInnovations.has(k));
            return `
                <div class="feedback success">
                    <h3>🎉 Innovation Already Completed!</h3>
                    <p><strong>${idea.name}</strong> has been successfully launched!</p>
                    <p style="margin-top: 10px;">🏆 <em>Journey Status: Complete</em></p>
                </div>
                ${hasMore ? `<button class="btn btn-primary" onclick="G.tryAnother()">Try Another Innovation</button>` : ''}
            `;
        };
        
        const getNewInnovation = () => `
            <div class="no-solution">
                <h3>💡 New Innovation Opportunity!</h3>
                <p>No existing solution found. This is a great opportunity to innovate!</p>
            </div>
            <button class="btn btn-primary" onclick="G.proceed('s-lob')">Proceed to ICP SME Contact</button>
        `;
        
        const tryAnother = () => {
            $('result').style.display = 'none';
            state.currentIdea = null;
            $$('.btn-category').forEach(b => b.classList.remove('selected'));
        };
        
        const updateButtonStates = () => {
            Object.keys(CONFIG.innovations).forEach(type => {
                const btn = $(`${type}-btn`);
                const inn = CONFIG.innovations[type];
                if (btn) {
                    btn.classList.remove('completed', 'existing-solution');
                    if (state.completedInnovations.has(type)) {
                        btn.classList.add(inn.exists ? 'existing-solution' : 'completed');
                    }
                }
            });
        };
        
        const highlightNext = () => {
            $$('.btn-category').forEach(b => b.classList.remove('unexplored'));
            for (let key of Object.keys(CONFIG.innovations)) {
                if (!state.checkedInnovations.has(key)) {
                    $(`${key}-btn`).classList.add('unexplored');
                    break;
                }
            }
        };
        
        // Journey Progression
        const generateJourneyScreens = () => {
            const container = $('dynamic-screens');
            container.innerHTML = `
                <div id="s-lob" class="screen">
                    <h2>📞 Step 2: Contact Your ICP SME</h2>
                    <div class="process-flow" id="flow-lob"></div>
                    <div class="story-text"><p>Great! Your idea is new. Connect with your ICP Subject Matter Expert to submit it.</p></div>
                    <div class="card"><h3>Your Innovation:</h3><p id="selected-idea" class="story-text"></p></div>
                    <div class="dialog-box"><strong>ICP SME:</strong><br>"This looks promising! Let me help you submit this to ICP."</div>
                    <button class="btn btn-primary" onclick="G.proceed('s-triage')">Submit to ICP Pipeline</button>
                </div>
                
                <div id="s-triage" class="screen">
                    <h2>⚡ Step 3: Cit Dev Consult</h2>
                    <div class="process-flow" id="flow-triage"></div>
                    <div class="story-text"><p>Citizen Developer consultants review your innovation and assign it to the best team!</p></div>
                    <h3>Available Teams:</h3>
                    <div id="teams"></div>
                    <button class="btn btn-primary" onclick="G.assignTeam()">See Team Assignment</button>
                </div>
                
                <div id="s-incubation" class="screen">
                    <h2>🌱 Step 4: Incubation Marketplace</h2>
                    <div class="story-text"><p><strong>Calling All Citizen Developers!</strong> Turn innovative ideas into real applications.</p></div>
                    <div class="process-flow" id="flow-incubation"></div>
                    <div class="card">
                        <h3>Citizen Developer Tasks:</h3>
                        <div id="inc-tasks"></div>
                    </div>
                    <div id="inc-ready" style="display: none;" class="feedback success">
                        <h3>🎯 Ready for Development!</h3>
                        <p>All onboarding requirements completed!</p>
                    </div>
                    <div class="hint-box">💡 <strong>Why Incubation?</strong> Ensures proper training and project matching!</div>
                    <button class="btn btn-primary" id="inc-btn" onclick="G.progressIncubation()">Complete Next Task</button>
                </div>
                
                <div id="s-dev" class="screen">
                    <h2>💻 <span id="dev-step">Step 4</span>: Development</h2>
                    <div class="story-text"><p id="team-assign"></p></div>
                    <div class="process-flow" id="flow-dev"></div>
                    <div class="card"><h3>Development Progress:</h3><div id="dev-progress"></div></div>
                    <button class="btn btn-primary" onclick="G.progressDev()">Continue Development</button>
                </div>
                
                <div id="s-lt" class="screen">
                    <h2>🎯 <span id="lt-step">Step 5</span>: LT Approval</h2>
                    <div class="story-text"><p>Development complete! Leadership Team reviews for scaling.</p></div>
                    <div class="process-flow" id="flow-lt"></div>
                    <div class="feedback success" style="margin-top: 30px;">
                        <h3>✅ Leadership Approved!</h3>
                        <p>Your innovation has been approved for enterprise-wide scaling.</p>
                    </div>
                    <button class="btn btn-primary" onclick="G.proceed('s-eng')" style="margin-top: 20px;">Scale Out!</button>
                </div>
                
                <div id="s-eng" class="screen">
                    <h2>🔧 <span id="eng-step">Step 6</span>: Engineering & Productization</h2>
                    <div class="story-text"><p>LT Approved! Engineering productizes for enterprise scale.</p></div>
                    <div class="process-flow" id="flow-eng"></div>
                    <div class="card"><h3>Engineering Tasks:</h3><div id="eng-tasks"></div></div>
                    <button class="btn btn-primary" onclick="G.completeEng()">Complete Productization</button>
                </div>
                
                <div id="s-success" class="screen">
                    <h2>🎉 Mission Complete!</h2>
                    <div style="width: 80px; height: 80px; margin: 0 auto 15px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px;">🏆</div>
                    <div class="feedback success">
                        <h3>What You Learned:</h3>
                        <ul style="text-align: left; color: #059669; line-height: 1.8; padding-left: 20px;">
                            <li>How to validate if a solution already exists</li>
                            <li>The ICP submission process through your ICP SME</li>
                            <li>How Citizen Dev consultants match ideas to teams</li>
                            <li>The development and scaling process</li>
                            <li>How innovations become enterprise solutions</li>
                        </ul>
                    </div>
                    <div id="next-action" style="background: linear-gradient(145deg, #f0f9ff, #dbeafe); border: 2px solid #0ea5e9; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center;"></div>
                    <div class="hint-box">🌟 <strong>ICP Impact:</strong> Your innovation is now helping thousands!</div>
                    <button class="btn btn-primary" onclick="G.exploreMore()">Explore More Innovations</button>
                </div>
            `;
            
            // Initialize teams
            $('teams').innerHTML = Object.entries(CONFIG.teams).map(([id, name]) => 
                `<div class="team-card" id="${id}" onclick="G.selectTeam('${id}')"><strong>${name.split('-')[0]}</strong><br><small>${name.split('-')[1]}</small></div>`
            ).join('');
            
            // Initialize incubation tasks
            $('inc-tasks').innerHTML = ['Adopt an idea', 'Project Accountability', 'Onboarding'].map((task, i) => 
                `<div class="requirement-item"><p id="req${i+1}" style="color: #6b7280;">⏳ ${task}</p></div>`
            ).join('');
            
            // Initialize dev progress
            $('dev-progress').innerHTML = '<p>⏳ Sprint 1: Requirements gathering...</p>';
            
            // Initialize eng tasks
            $('eng-tasks').innerHTML = `
                <p>✅ Security review completed</p>
                <p>✅ Performance optimization done</p>
                <p>⏳ Scalability testing in progress...</p>
            `;
        };
        
        const proceed = (screen) => {
            const inn = CONFIG.innovations[state.currentIdea];
            
            if (screen === 's-lob') {
                renderFlow('flow-lob', 2);
                $('selected-idea').textContent = inn.name;
                if (!state.scoredActions.lob.has(state.currentIdea)) {
                    updateScore(10, "ICP SME contact initiated");
                    state.scoredActions.lob.add(state.currentIdea);
                }
            } else if (screen === 's-triage') {
                renderFlow('flow-triage', 3);
                if (!state.scoredActions.icp.has(state.currentIdea)) {
                    updateScore(25, "Idea submitted to ICP");
                    state.ideas++;
                    $('ideas').textContent = state.ideas;
                    state.scoredActions.icp.add(state.currentIdea);
                }
            } else if (screen === 's-eng') {
                const isEight = state.currentIdea === 'assistant';
                $('eng-step').textContent = isEight ? 'Step 7' : 'Step 6';
                renderFlow('flow-eng', isEight ? 7 : 6);
            }
            
            showScreen(screen);
        };
        
        const selectTeam = (id) => {
            $$('.team-card').forEach(t => t.classList.remove('selected'));
            $(id).classList.add('selected');
            state.currentTeam = id;
        };
        
        const assignTeam = () => {
            const team = CONFIG.innovations[state.currentIdea]?.bestTeam || 'team4';
            selectTeam(team);
            
            if (!state.scoredActions.team.has(state.currentIdea)) {
                updateScore(30, "Team assigned");
                state.scoredActions.team.add(state.currentIdea);
            }
            
            setTimeout(() => {
                if (team === 'team4') {
                    showScreen('s-incubation');
                    renderFlow('flow-incubation', 4);
                } else {
                    showDevScreen();
                }
            }, 2000);
        };
        
        const progressIncubation = () => {
            state.incubationStage++;
            const tasks = [
                { id: 'req1', text: '✅ Adopt an idea', points: 15, action: "Idea adopted" },
                { id: 'req2', text: '✅ Project Accountability', points: 20, action: "Accountability accepted" },
                { id: 'req3', text: '✅ Onboarding', points: 25, action: "Onboarding completed" }
            ];
            
            if (state.incubationStage <= tasks.length) {
                const task = tasks[state.incubationStage - 1];
                const el = $(task.id);
                if (el) {
                    el.innerHTML = task.text;
                    el.style.cssText = 'color: white; font-weight: bold;';
                    el.parentElement.style.cssText = 'background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 2px 4px rgba(0,0,0,0.2);';
                }
                
                const key = `${state.currentIdea}_${state.incubationStage}`;
                if (!state.scoredActions.incubation.has(key)) {
                    updateScore(task.points, task.action);
                    state.scoredActions.incubation.add(key);
                }
                
                if (state.incubationStage >= tasks.length) {
                    $('inc-ready').style.display = 'block';
                    $('inc-btn').textContent = 'Proceed to Development';
                    $('inc-btn').onclick = () => showDevScreen();
                }
            }
        };
        
        const showDevScreen = () => {
            const isEight = state.currentIdea === 'assistant';
            $('dev-step').textContent = isEight ? 'Step 5' : 'Step 4';
            renderFlow('flow-dev', isEight ? 5 : 4);
            $('team-assign').textContent = `Assigned to: ${CONFIG.teams[state.currentTeam]}`;
            showScreen('s-dev');
        };
        
        const progressDev = () => {
            state.devStage++;
            const stages = [
                '✅ Sprint 1: Requirements gathering complete',
                '✅ Sprint 2: Prototype developed',
                '✅ Sprint 3: Testing completed',
                '✅ Sprint 4: Ready for productization!'
            ];
            
            if (state.devStage < stages.length) {
                $('dev-progress').innerHTML = stages.slice(0, state.devStage + 1).map(s => `<p>${s}</p>`).join('');
                
                const key = `${state.currentIdea}_sprint${state.devStage}`;
                if (!state.scoredActions.development.has(key)) {
                    updateScore(20, `Sprint ${state.devStage + 1} completed`);
                    state.scoredActions.development.add(key);
                }
            } else {
                showLTScreen();
                state.devStage = 0;
            }
        };
        
        const showLTScreen = () => {
            const isEight = state.currentIdea === 'assistant';
            $('lt-step').textContent = isEight ? 'Step 6' : 'Step 5';
            renderFlow('flow-lt', isEight ? 6 : 5);
            
            if (!state.scoredActions.ltApproval.has(state.currentIdea)) {
                updateScore(40, "Leadership approval");
                state.scoredActions.ltApproval.add(state.currentIdea);
            }
            
            showScreen('s-lt');
        };
        
        const completeEng = () => {
            $('eng-tasks').innerHTML = `
                <p>✅ Security review completed</p>
                <p>✅ Performance optimization done</p>
                <p>✅ Scalability testing completed</p>
                <p>✅ Production deployment ready!</p>
            `;
            
            if (!state.scoredActions.engineering.has(state.currentIdea)) {
                updateScore(50, "Engineering completed");
                state.scoredActions.engineering.add(state.currentIdea);
            }
            
            setTimeout(() => showSuccessScreen(), 1500);
        };
        
        const showSuccessScreen = () => {
            if (state.currentIdea) {
                const inn = CONFIG.innovations[state.currentIdea];
                showAchievement("Journey Complete!", `Completed: ${inn.name}`);
                state.completedInnovations.add(state.currentIdea);
            }
            
            const allDone = Object.keys(CONFIG.innovations).every(k => {
                const inn = CONFIG.innovations[k];
                return inn.exists ? state.checkedInnovations.has(k) : state.completedInnovations.has(k);
            });
            
            const nextAction = $('next-action');
            if (!allDone) {
                const remaining = Object.keys(CONFIG.innovations).filter(k => {
                    const inn = CONFIG.innovations[k];
                    return inn.exists ? !state.checkedInnovations.has(k) : !state.completedInnovations.has(k);
                }).length;
                
                nextAction.innerHTML = `
                    <h4 style="color: #0284c7;">What's Next?</h4>
                    <p><strong>${remaining} innovation${remaining > 1 ? 's' : ''} still to explore!</strong></p>
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <p style="color: #0284c7; font-weight: bold;">Ready with your own idea?</p>
                        <p style="margin-top: 8px;">📌 Visit the <a href="https://aka.ms/AIInnovationFrontDoor" target="_blank" style="color: #667eea; font-weight: bold;">AI Innovation Front Door</a></p>
                        <p style="margin-top: 8px; color: #6b7280; font-style: italic;">or</p>
                        <p style="margin-top: 8px;">📧 Contact our team directly: <a href="mailto:ICP_Inquiries@microsoft.com" style="color: #667eea; font-weight: bold;">ICP_Inquiries@microsoft.com</a></p>
                    </div>
                `;
            } else {
                nextAction.innerHTML = `
                    <h4 style="color: #0284c7;">Journey Summary</h4>
                    <div style="text-align: left; color: #059669; line-height: 1.8;">
                        <p>✅ All journeys completed!</p>
                    </div>
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e5e7eb; text-align: center;">
                        <p style="color: #0284c7; font-weight: bold;">Ready to submit a real idea?</p>
                        <p style="margin-top: 8px;">📌 Visit the <a href="https://aka.ms/AIInnovationFrontDoor" target="_blank" style="color: #667eea; font-weight: bold;">AI Innovation Front Door</a></p>
                        <p style="margin-top: 8px; color: #6b7280; font-style: italic;">or</p>
                        <p style="margin-top: 8px;">📧 Contact: <a href="mailto:ICP_Inquiries@microsoft.com" style="color: #667eea; font-weight: bold;">ICP_Inquiries@microsoft.com</a></p>
                    </div>
                `;
            }
            
            showScreen('s-success');
        };
        
        const exploreMore = () => {
            resetState();
            showScreen('s-discovery');
            updateButtonStates();
            highlightNext();
            updateProgress();
        };
        
        const resetState = () => {
            state.currentIdea = null;
            state.currentTeam = null;
            state.devStage = 0;
            state.incubationStage = 0;
            
            $$('.team-card, .btn-category').forEach(e => e.classList.remove('selected'));
            $('result').style.display = 'none';
            
            // Reset incubation
            ['Adopt an idea', 'Project Accountability', 'Onboarding'].forEach((task, i) => {
                const el = $(`req${i+1}`);
                if (el) {
                    el.innerHTML = `⏳ ${task}`;
                    el.style.cssText = 'color: #6b7280;';
                    el.parentElement.style.cssText = '';
                }
            });
            $('inc-ready').style.display = 'none';
            $('inc-btn').textContent = 'Complete Next Task';
            $('inc-btn').onclick = () => progressIncubation();
            
            // Reset dev & eng
            $('dev-progress').innerHTML = '<p>⏳ Sprint 1: Requirements gathering...</p>';
            $('eng-tasks').innerHTML = `
                <p>✅ Security review completed</p>
                <p>✅ Performance optimization done</p>
                <p>⏳ Scalability testing in progress...</p>
            `;
        };
        
        // Scroll Management
        const initScroll = () => {
            let hasScrolled = false;
            
            const updateScroll = () => {
                const h = window.innerHeight;
                const dh = document.documentElement.scrollHeight - h;
                const s = window.scrollY;
                const progress = dh > 0 ? s / dh : 0;
                
                $('scroll-bar').style.transform = `scaleX(${progress})`;
                
                const shouldShow = dh > 50 && s < dh - 100;
                $('scroll-btn').classList.toggle('hidden', !shouldShow || hasScrolled);
                $('scroll-txt').classList.toggle('hidden', !shouldShow || hasScrolled || s > 50);
                
                if (s > 50) hasScrolled = true;
            };
            
            window.addEventListener('scroll', updateScroll);
            window.addEventListener('resize', updateScroll);
            
            const originalShow = showScreen;
            window.showScreen = (id) => {
                originalShow(id);
                setTimeout(() => {
                    hasScrolled = false;
                    updateScroll();
                }, 300);
            };
            
            updateScroll();
        };
        
        const scrollDown = () => {
            window.scrollTo({ top: window.scrollY + window.innerHeight * 0.8, behavior: 'smooth' });
        };
        
        // Mobile Optimization
        const initMobile = () => {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
            
            if (isMobile) {
                document.body.style.overscrollBehavior = 'none';
                document.documentElement.style.overflowY = 'scroll';
            }
            
            // Touch feedback
            document.addEventListener('touchstart', e => {
                if (e.target.tagName === 'BUTTON' || e.target.classList.contains('team-card')) {
                    e.target.style.opacity = '0.8';
                }
            });
            
            document.addEventListener('touchend', e => {
                if (e.target.tagName === 'BUTTON' || e.target.classList.contains('team-card')) {
                    setTimeout(() => e.target.style.opacity = '', 100);
                }
            });
            
            // Prevent double-tap zoom
            let lastTouch = 0;
            document.addEventListener('touchend', e => {
                const now = Date.now();
                if (now - lastTouch <= 300) e.preventDefault();
                lastTouch = now;
            }, false);
        };
        
        // Public API
        return {
            start: () => {
                resetState();
                updateButtonStates();
                highlightNext();
                showScreen('s-discovery');
                
                if (state.firstTimeUser) {
                    $('hint').style.display = 'block';
                    state.firstTimeUser = false;
                    setTimeout(() => $('hint').style.display = 'none', 5000);
                }
                
                if (!state.journeyStarted) {
                    updateScore(10, "Journey Started");
                    state.journeyStarted = true;
                }
                
                renderFlow('flow-discovery', 1, 7);
                updateProgress();
            },
            checkIdea,
            tryAnother,
            proceed,
            selectTeam,
            assignTeam,
            progressIncubation,
            progressDev,
            completeEng,
            exploreMore,
            closeAchievement,
            scrollDown,
            showHelp: () => $('help-modal').classList.add('show'),
            closeHelp: () => $('help-modal').classList.remove('show'),
            init: () => {
                initInnovations();
                generateJourneyScreens();
                initScroll();
                initMobile();
                updateTracker();
            }
        };
    })();
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', G.init);
    </script>
</body>
</html>
